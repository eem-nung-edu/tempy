<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç–µ–∫—Ü—ñ—è –±—Ä–∞—É–∑–µ—Ä–∞ Telegram</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .warning {
            background-color: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        .error {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        .debug-info {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .test-functions {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .function-test {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–î–µ—Ç–µ–∫—Ü—ñ—è –≤–±—É–¥–æ–≤–∞–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ Telegram</h1>
        
        <div id="main-result"></div>
        
        <button onclick="runFullDetection()">–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ø–æ–≤–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É</button>
        <button onclick="testBrowserFeatures()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó –±—Ä–∞—É–∑–µ—Ä–∞</button>
        
        <div id="detection-results"></div>
        
        <div class="test-functions">
            <h3>–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π –±—Ä–∞—É–∑–µ—Ä–∞:</h3>
            <div id="feature-tests"></div>
        </div>
        
        <div id="debug-section" style="display: none;">
            <h3>–î–µ—Ç–∞–ª—å–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:</h3>
            <div id="debug-info"></div>
        </div>
        
        <button onclick="toggleDebug()">–ü–æ–∫–∞–∑–∞—Ç–∏/–°—Ö–æ–≤–∞—Ç–∏ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
    </div>

    <script>
        // –†–æ–∑—à–∏—Ä–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–µ—Ç–µ–∫—Ü—ñ—ó Telegram –±—Ä–∞—É–∑–µ—Ä–∞
        function detectTelegramBrowser() {
            const userAgent = navigator.userAgent || '';
            const vendor = navigator.vendor || '';
            const platform = navigator.platform || '';
            
            const detection = {
                isTelegram: false,
                confidence: 0,
                methods: {},
                browserInfo: {
                    userAgent,
                    vendor,
                    platform,
                    languages: navigator.languages || [],
                    cookieEnabled: navigator.cookieEnabled,
                    doNotTrack: navigator.doNotTrack,
                    maxTouchPoints: navigator.maxTouchPoints || 0
                }
            };

            // –ú–µ—Ç–æ–¥ 1: –ü—Ä—è–º–∏–π User Agent
            detection.methods.directUA = /telegram/i.test(userAgent);
            if (detection.methods.directUA) detection.confidence += 80;

            // –ú–µ—Ç–æ–¥ 2: –ù–µ—è–≤–Ω—ñ –æ–∑–Ω–∞–∫–∏ –≤ User Agent
            detection.methods.indirectUA = {
                // Telegram —á–∞—Å—Ç–æ –º–∞—Å–∫—É—î—Ç—å—Å—è –ø—ñ–¥ Chrome
                fakeChrome: /Chrome\/\d+\.\d+\.\d+\.\d+.*Mobile.*Safari/i.test(userAgent) && !/Edge|OPR|Edg/i.test(userAgent),
                // –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Ç–∏–ø–æ–≤–∏—Ö –º–æ–±—ñ–ª—å–Ω–∏—Ö –±—Ä–∞—É–∑–µ—Ä—ñ–≤
                notTypicalMobile: !/Samsung|Huawei|Xiaomi|OnePlus|LG|Motorola/i.test(userAgent),
                // –û—Å–æ–±–ª–∏–≤—ñ –≤–µ—Ä—Å—ñ—ó Chrome
                suspiciousChrome: /Chrome\/9[0-9]\./i.test(userAgent) && /Mobile/i.test(userAgent),
                // –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ –ø—Ä–∏—Å—Ç—Ä—ñ–π
                genericDevice: /Mobile.*Safari/i.test(userAgent) && !/iPhone|iPad|Android/i.test(userAgent)
            };
            
            const indirectMatches = Object.values(detection.methods.indirectUA).filter(Boolean).length;
            if (indirectMatches >= 2) detection.confidence += 30;

            // –ú–µ—Ç–æ–¥ 3: –ê–Ω–∞–ª—ñ–∑ –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π –±—Ä–∞—É–∑–µ—Ä–∞
            detection.methods.browserCapabilities = {
                // Telegram –±—Ä–∞—É–∑–µ—Ä —á–∞—Å—Ç–æ –º–∞—î –æ–±–º–µ–∂–µ–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ
                noWebGL: !checkWebGLSupport(),
                noWebRTC: !checkWebRTCSupport(),
                noServiceWorker: !('serviceWorker' in navigator),
                noNotifications: !('Notification' in window),
                noWebSpeech: !('speechSynthesis' in window),
                noWebAssembly: typeof WebAssembly === 'undefined',
                noIndexedDB: !('indexedDB' in window),
                noWebSockets: typeof WebSocket === 'undefined'
            };
            
            const disabledFeatures = Object.values(detection.methods.browserCapabilities).filter(Boolean).length;
            if (disabledFeatures >= 3) detection.confidence += 25;

            // –ú–µ—Ç–æ–¥ 4: –ê–Ω–∞–ª—ñ–∑ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—ó
            detection.methods.navigationRestrictions = {
                // Telegram –º–æ–∂–µ –æ–±–º–µ–∂—É–≤–∞—Ç–∏ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—é
                historyLength: window.history.length <= 1,
                noOpener: !window.opener,
                restrictedReferrer: !document.referrer || document.referrer.includes('telegram'),
                noBackButton: !window.history.back
            };
            
            const navRestrictions = Object.values(detection.methods.navigationRestrictions).filter(Boolean).length;
            if (navRestrictions >= 2) detection.confidence += 20;

            // –ú–µ—Ç–æ–¥ 5: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–∏—Ö API
            detection.methods.restrictedAPIs = {
                noLocalStorage: !testLocalStorage(),
                noSessionStorage: !testSessionStorage(),
                noClipboard: !testClipboardAPI(),
                noCamera: !testCameraAPI(),
                noMicrophone: !testMicrophoneAPI(),
                noGeolocation: !testGeolocationAPI(),
                noFullscreen: !testFullscreenAPI()
            };
            
            const restrictedAPIs = Object.values(detection.methods.restrictedAPIs).filter(Boolean).length;
            if (restrictedAPIs >= 3) detection.confidence += 40;

            // –ú–µ—Ç–æ–¥ 6: –ê–Ω–∞–ª—ñ–∑ —Ä–æ–∑–º—ñ—Ä—É –µ–∫—Ä–∞–Ω—É —Ç–∞ viewport
            detection.methods.screenAnalysis = {
                suspiciousViewport: window.innerWidth === screen.width && window.innerHeight < screen.height,
                noScreenOrientation: !screen.orientation,
                staticViewport: !testViewportChanges()
            };
            
            const screenIssues = Object.values(detection.methods.screenAnalysis).filter(Boolean).length;
            if (screenIssues >= 2) detection.confidence += 15;

            // –ú–µ—Ç–æ–¥ 7: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –¥–ª—è Telegram –æ–±'—î–∫—Ç—ñ–≤
            detection.methods.telegramSpecific = {
                hasTelegramObject: typeof window.Telegram !== 'undefined',
                hasTelegramWebApp: !!(window.Telegram && window.Telegram.WebApp),
                hasTelegramWebviewProxy: typeof window.TelegramWebviewProxy !== 'undefined',
                telegramURLParams: checkTelegramURLParams()
            };
            
            if (detection.methods.telegramSpecific.hasTelegramObject) detection.confidence += 90;
            if (detection.methods.telegramSpecific.hasTelegramWebApp) detection.confidence += 95;

            // –§—ñ–Ω–∞–ª—å–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è
            detection.isTelegram = detection.confidence >= 50;
            
            return detection;
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
        function checkWebGLSupport() {
            try {
                const canvas = document.createElement('canvas');
                return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
            } catch (e) {
                return false;
            }
        }

        function checkWebRTCSupport() {
            return !!(window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection);
        }

        function testLocalStorage() {
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                return true;
            } catch (e) {
                return false;
            }
        }

        function testSessionStorage() {
            try {
                sessionStorage.setItem('test', 'test');
                sessionStorage.removeItem('test');
                return true;
            } catch (e) {
                return false;
            }
        }

        function testClipboardAPI() {
            return !!(navigator.clipboard && navigator.clipboard.writeText);
        }

        function testCameraAPI() {
            return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
        }

        function testMicrophoneAPI() {
            return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
        }

        function testGeolocationAPI() {
            return !!navigator.geolocation;
        }

        function testFullscreenAPI() {
            return !!(document.documentElement.requestFullscreen || document.documentElement.webkitRequestFullscreen);
        }

        function testViewportChanges() {
            // –ü—Ä–æ—Å—Ç–∏–π —Ç–µ—Å—Ç –Ω–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–º—ñ–Ω–∏ viewport
            const initialWidth = window.innerWidth;
            return true; 
        }

        function checkTelegramURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.has('tgWebAppData') || 
                   urlParams.has('tgWebAppVersion') || 
                   urlParams.has('tgWebAppPlatform') ||
                   document.referrer.includes('telegram');
        }

        function runFullDetection() {
            const detection = detectTelegramBrowser();
            
            // –û—Å–Ω–æ–≤–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const mainResult = document.getElementById('main-result');
            if (detection.isTelegram) {
                mainResult.innerHTML = `
                    <div class="result success">
                        <h3>üîç Telegram –±—Ä–∞—É–∑–µ—Ä –¥–µ—Ç–µ–∫—Ç–æ–≤–∞–Ω–∏–π!</h3>
                        <p><strong>–†—ñ–≤–µ–Ω—å –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ:</strong> ${detection.confidence}%</p>
                        <p><em>–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</em></p>
                    </div>
                `;
            } else {
                mainResult.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Telegram –±—Ä–∞—É–∑–µ—Ä –ù–ï –¥–µ—Ç–µ–∫—Ç–æ–≤–∞–Ω–∏–π</h3>
                        <p><strong>–†—ñ–≤–µ–Ω—å –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ:</strong> ${detection.confidence}%</p>
                        <p><em>–í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø–æ–≤–∏–Ω–Ω—ñ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ</em></p>
                    </div>
                `;
            }

            // –î–µ—Ç–∞–ª—å–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
            const resultsDiv = document.getElementById('detection-results');
            let html = '<h4>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–µ—Ç–µ–∫—Ü—ñ—ó:</h4>';
            
            Object.entries(detection.methods).forEach(([method, results]) => {
                html += `<div class="result info"><strong>${method}:</strong><br>`;
                if (typeof results === 'object') {
                    Object.entries(results).forEach(([check, result]) => {
                        const icon = result ? '‚úì' : '‚úó';
                        html += `${icon} ${check}: ${result}<br>`;
                    });
                } else {
                    const icon = results ? '‚úì' : '‚úó';
                    html += `${icon} ${method}: ${results}`;
                }
                html += '</div>';
            });
            
            resultsDiv.innerHTML = html;

            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω—É –∑–º—ñ–Ω–Ω—É
            window.isTelegramBrowser = detection.isTelegram;
            window.telegramDetectionData = detection;
        }

        function testBrowserFeatures() {
            const tests = [
                { name: 'localStorage', test: testLocalStorage },
                { name: 'sessionStorage', test: testSessionStorage },
                { name: 'WebGL', test: checkWebGLSupport },
                { name: 'WebRTC', test: checkWebRTCSupport },
                { name: 'Clipboard API', test: testClipboardAPI },
                { name: 'Camera API', test: testCameraAPI },
                { name: 'Geolocation', test: testGeolocationAPI },
                { name: 'Fullscreen API', test: testFullscreenAPI },
                { name: 'Service Worker', test: () => 'serviceWorker' in navigator },
                { name: 'Notifications', test: () => 'Notification' in window },
                { name: 'WebAssembly', test: () => typeof WebAssembly !== 'undefined' },
                { name: 'IndexedDB', test: () => 'indexedDB' in window }
            ];

            const testsDiv = document.getElementById('feature-tests');
            let html = '';

            tests.forEach(({ name, test }) => {
                const result = test();
                const className = result ? 'success' : 'error';
                const icon = result ? '‚úÖ' : '‚ùå';
                html += `<div class="function-test result ${className}">${icon} ${name}: ${result ? '–ü—Ä–∞—Ü—é—î' : '–ù–µ –ø—Ä–∞—Ü—é—î'}</div>`;
            });

            testsDiv.innerHTML = html;
        }

        function toggleDebug() {
            const debugSection = document.getElementById('debug-section');
            if (debugSection.style.display === 'none') {
                const detection = detectTelegramBrowser();
                const debugInfo = document.getElementById('debug-info');
                debugInfo.innerHTML = `<div class="debug-info">${JSON.stringify(detection, null, 2)}</div>`;
                debugSection.style.display = 'block';
            } else {
                debugSection.style.display = 'none';
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('load', function() {
            runFullDetection();
            testBrowserFeatures();
        });

        // –ï–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–¥—ñ
        window.detectTelegramBrowser = detectTelegramBrowser;
    </script>
</body>
</html>